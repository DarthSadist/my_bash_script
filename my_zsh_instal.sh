#!/bin/bash

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
print_step() {
    echo -e "\nüì¶ \033[1m$1\033[0m"
}

print_info() {
    echo -e "   ‚ÑπÔ∏è  $1"
}

print_success() {
    echo -e "   ‚úÖ $1"
}

print_error() {
    echo -e "   ‚ùå \033[31m$1\033[0m"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏–Ω–Ω–µ—Ä–∞
spinner() {
    local pid=$1
    local delay=0.1
    local spinstr='‚†ã‚†ô‚†π‚†∏‚†º‚†¥‚†¶‚†ß‚†á‚†è'
    while [ "$(ps a | awk '{print $1}' | grep $pid)" ]; do
        local temp=${spinstr#?}
        printf "   \033[34m%c\033[0m  " "$spinstr"
        local spinstr=$temp${spinstr%"$temp"}
        sleep $delay
        printf "\b\b\b\b\b"
    done
    printf "    \b\b\b\b"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
run_with_spinner() {
    local message=$1
    shift
    echo -ne "   üîÑ $message"
    ("$@") &>/dev/null &
    spinner $!
    if [ $? -eq 0 ]; then
        echo -e "\r   ‚úÖ $message"
    else
        echo -e "\r   ‚ùå $message"
        return 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
progress_bar() {
    local current=$1
    local total=$2
    local title=$3
    local width=50
    local percentage=$((current * 100 / total))
    local completed=$((width * current / total))
    local remaining=$((width - completed))
    
    printf "\r   üìä \033[1m%s\033[0m [" "$title"
    printf "%${completed}s" | tr ' ' '‚ñà'
    printf "%${remaining}s" | tr ' ' '‚ñë'
    printf "] %d%%" "$percentage"
    
    if [ "$current" -eq "$total" ]; then
        echo
    fi
}

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫
check_existing_installation() {
    local USER_HOME="$1"
    local has_existing=false
    local message=""

    print_step "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫"

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    if [ ! -r "$USER_HOME" ]; then
        print_error "–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —á—Ç–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ '$USER_HOME'"
        return 1
    fi

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Zsh
    if command -v zsh >/dev/null 2>&1; then
        print_info "–ù–∞–π–¥–µ–Ω: Zsh"
        has_existing=true
    fi

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Oh My Zsh
    if [ -d "$USER_HOME/.oh-my-zsh" ]; then
        print_info "–ù–∞–π–¥–µ–Ω: Oh My Zsh"
        has_existing=true
    fi

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Powerlevel10k
    if [ -d "$USER_HOME/.powerlevel10k" ]; then
        print_info "–ù–∞–π–¥–µ–Ω: Powerlevel10k"
        has_existing=true
    fi

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤
    local plugins_dir="${ZSH_CUSTOM:-$USER_HOME/.oh-my-zsh/custom}/plugins"
    if [ -d "$plugins_dir" ]; then
        if [ -d "$plugins_dir/zsh-syntax-highlighting" ]; then
            print_info "–ù–∞–π–¥–µ–Ω: zsh-syntax-highlighting"
            has_existing=true
        fi
        if [ -d "$plugins_dir/zsh-autosuggestions" ]; then
            print_info "–ù–∞–π–¥–µ–Ω: zsh-autosuggestions"
            has_existing=true
        fi
    fi

    # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    if [ "$has_existing" = true ]; then
        echo
        print_info "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏. –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
        echo "      1) –£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
        echo "      2) –û—Ç–º–µ–Ω–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É"
        
        while true; do
            read -r choice
            case $choice in
                1)
                    remove_existing_installation "$USER_HOME"
                    return $?
                    ;;
                2)
                    print_info "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞"
                    exit 0
                    ;;
                *)
                    print_error "–í–≤–µ–¥–∏—Ç–µ 1 –∏–ª–∏ 2"
                    ;;
            esac
        done
    fi
    
    return 0
}

# –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫
remove_existing_installation() {
    local USER_HOME="$1"
    local current_shell=$(echo $SHELL)
    
    print_step "–£–¥–∞–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫"
    
    # –í–æ–∑–≤—Ä–∞—Ç –∫ bash –µ—Å–ª–∏ —Ç–µ–∫—É—â–∞—è –æ–±–æ–ª–æ—á–∫–∞ zsh
    if [[ "$current_shell" == *"zsh"* ]]; then
        print_info "–°–º–µ–Ω–∞ –æ–±–æ–ª–æ—á–∫–∏ –Ω–∞ bash..."
        if ! chsh -s $(which bash) $(whoami); then
            print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ–±–æ–ª–æ—á–∫–∏ –Ω–∞ bash"
            return 1
        fi
    fi

    # –£–¥–∞–ª–µ–Ω–∏–µ Oh My Zsh
    if [ -d "$USER_HOME/.oh-my-zsh" ]; then
        print_info "–£–¥–∞–ª–µ–Ω–∏–µ Oh My Zsh..."
        rm -rf "$USER_HOME/.oh-my-zsh" 2>/dev/null || sudo rm -rf "$USER_HOME/.oh-my-zsh"
    fi

    # –£–¥–∞–ª–µ–Ω–∏–µ Powerlevel10k
    if [ -d "$USER_HOME/.powerlevel10k" ]; then
        print_info "–£–¥–∞–ª–µ–Ω–∏–µ Powerlevel10k..."
        rm -rf "$USER_HOME/.powerlevel10k" 2>/dev/null || sudo rm -rf "$USER_HOME/.powerlevel10k"
    fi

    # –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    print_info "–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
    rm -f "$USER_HOME/.zshrc" "$USER_HOME/.zsh_history" "$USER_HOME/.zcompdump"* "$USER_HOME/.p10k.zsh" 2>/dev/null

    # –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤
    local plugins_dir="${ZSH_CUSTOM:-$USER_HOME/.oh-my-zsh/custom}/plugins"
    if [ -d "$plugins_dir" ]; then
        print_info "–£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤..."
        rm -rf "$plugins_dir/zsh-syntax-highlighting" "$plugins_dir/zsh-autosuggestions" 2>/dev/null || \
        sudo rm -rf "$plugins_dir/zsh-syntax-highlighting" "$plugins_dir/zsh-autosuggestions"
    fi

    print_success "–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
    return 0
}

# –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
install_zsh() {
    local USER_HOME="$1"
    local INSTALL_TYPE="$2"

    print_step "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh My Zsh"
    if [ ! -d "$USER_HOME/.oh-my-zsh" ]; then
        [ -f "$USER_HOME/.zshrc" ] && mv "$USER_HOME/.zshrc" "$USER_HOME/.zshrc.pre-oh-my-zsh"
        print_info "–ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh My Zsh..."
        if run_with_spinner "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh My Zsh" sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended; then
            print_success "Oh My Zsh —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        else
            print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Oh My Zsh"
            exit 1
        fi
    fi

    print_step "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤"
    local plugins_dir="${ZSH_CUSTOM:-$USER_HOME/.oh-my-zsh/custom}/plugins"
    mkdir -p "$plugins_dir"
    
    local total_plugins=4
    local current_plugin=0
    
    print_info "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤..."
    if [ ! -d "$plugins_dir/zsh-syntax-highlighting" ]; then
        ((current_plugin++))
        progress_bar $current_plugin $total_plugins "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤"
        if run_with_spinner "zsh-syntax-highlighting" git clone -q https://github.com/zsh-users/zsh-syntax-highlighting.git "$plugins_dir/zsh-syntax-highlighting"; then
            print_success "zsh-syntax-highlighting —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        else
            print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ zsh-syntax-highlighting"
        fi
    fi
    
    if [ ! -d "$plugins_dir/zsh-autosuggestions" ]; then
        ((current_plugin++))
        progress_bar $current_plugin $total_plugins "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤"
        if run_with_spinner "zsh-autosuggestions" git clone -q https://github.com/zsh-users/zsh-autosuggestions.git "$plugins_dir/zsh-autosuggestions"; then
            print_success "zsh-autosuggestions —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        else
            print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ zsh-autosuggestions"
        fi
    fi
    
    if [ ! -d "$USER_HOME/.powerlevel10k" ]; then
        ((current_plugin++))
        progress_bar $current_plugin $total_plugins "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤"
        if run_with_spinner "powerlevel10k" git clone -q --depth=1 https://github.com/romkatv/powerlevel10k.git "$USER_HOME/.powerlevel10k"; then
            print_success "powerlevel10k —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        else
            print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ powerlevel10k"
        fi
    fi

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ fzf
    if [ ! -d "$USER_HOME/.fzf" ]; then
        ((current_plugin++))
        progress_bar $current_plugin $total_plugins "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤"
        if run_with_spinner "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ fzf" git clone -q --depth 1 https://github.com/junegunn/fzf.git "$USER_HOME/.fzf"; then
            if run_with_spinner "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ fzf" "$USER_HOME/.fzf/install" --all; then
                print_success "fzf —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            else
                print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ fzf"
            fi
        else
            print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ fzf"
        fi
    fi

    print_step "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
    
    # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ –∫–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    TEMP_DIR=$(mktemp -d)
    print_info "–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    if ! ssh -T git@github.com &>/dev/null; then
        print_error "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ GitHub —á–µ—Ä–µ–∑ SSH. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à–∏ SSH –∫–ª—é—á–∏"
        rm -rf "$TEMP_DIR"
        exit 1
    fi

    if run_with_spinner "–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" git clone git@github.com:DarthSadist/my_zsh.git "$TEMP_DIR"; then
        print_info "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        if [ ! -d "$TEMP_DIR" ]; then
            print_error "–û—à–∏–±–∫–∞: –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–µ —Å–æ–∑–¥–∞–Ω–∞"
            exit 1
        fi

        # –í—ã–≤–æ–¥–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        ls -la "$TEMP_DIR"

        # –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É FZF_BASE
        if [ -f "$TEMP_DIR/.zshrc" ]; then
            print_info "–ù–∞–π–¥–µ–Ω —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º..."
            if run_with_spinner "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" cp "$TEMP_DIR/.zshrc" "$USER_HOME/.zshrc"; then
                echo -e "\n# fzf configuration\nexport FZF_BASE=$USER_HOME/.fzf" >> "$USER_HOME/.zshrc"
                print_success "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
            else
                print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞"
                rm -rf "$TEMP_DIR"
                exit 1
            fi
        else
            print_error "–§–∞–π–ª .zshrc –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏"
            print_info "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:"
            ls -la "$TEMP_DIR"
            rm -rf "$TEMP_DIR"
            exit 1
        fi
    else
        print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π"
        print_info "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: git@github.com:DarthSadist/my_zsh.git"
        rm -rf "$TEMP_DIR"
        exit 1
    fi

    # –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
    rm -rf "$TEMP_DIR"

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ñ–∞–π–ª—ã
    chown -R $(whoami):$(whoami) "$USER_HOME/.oh-my-zsh" "$USER_HOME/.zshrc" "$USER_HOME/.powerlevel10k" 2>/dev/null

    echo
    print_success "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
    echo
    print_info "–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:"
    echo "      1. –ó–∞–∫—Ä–æ–π—Ç–µ —Ç–µ–∫—É—â–∏–π —Ç–µ—Ä–º–∏–Ω–∞–ª"
    echo "      2. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª"
    echo "      3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É: p10k configure"
    echo
}

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
main() {
    clear
    echo "‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ"
    echo "‚îÇ     –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Zsh –∏ Oh My Zsh     ‚îÇ"
    echo "‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ"
    echo
    print_info "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏:"
    echo "      1) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    echo "      2) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è root"
    echo "      3) –û—Ç–º–µ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏"
    echo
    
    while true; do
        read -r choice
        case $choice in
            1)
                install_zsh "$HOME" "user"
                break
                ;;
            2)
                if [ "$EUID" -ne 0 ]; then
                    print_error "–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ root —Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
                    exit 1
                fi
                install_zsh "/root" "root"
                break
                ;;
            3)
                print_info "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞"
                exit 0
                ;;
            *)
                print_error "–í–≤–µ–¥–∏—Ç–µ 1, 2 –∏–ª–∏ 3"
                ;;
        esac
    done
}

main
